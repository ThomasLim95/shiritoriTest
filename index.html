<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shiritori Game</title>
    <style>
        body { 
            font-family: 'Press Start 2P', cursive;
            text-align: center; 
            padding: 20px; 
            background-color: #fce4ec;
            color: #880e4f;
        }
        input, button { 
            padding: 10px; 
            font-size: 16px; 
            border: 2px solid #880e4f;
            background-color: #f8bbd0;
            color: #880e4f;
            font-family: 'Press Start 2P', cursive;
        }
        button:hover {
            background-color: #f48fb1;
        }
        #words { margin-top: 20px; font-size: 14px; }
        .scoreboard { margin-top: 20px; }
        .scoreboard h2 { font-size: 18px; }
        .scoreboard ul { list-style: none; padding: 0; }
        .scoreboard li { background: #f8bbd0; padding: 5px; margin: 5px; border-radius: 5px; }
        #lastWord { font-size: 18px; font-weight: bold; margin-top: 20px; }
        #nextLetter { font-size: 18px; color: #d81b60; }
        #dinoFrame {
            position: fixed;
            bottom: 10px;
            left: 10px;
            width: 100px;
            height: 100px;
            background: url('https://github.com/ThomasLim95/shiritoriTest/blob/main/super-mario-bros-mario-jumping.gif?raw=true') no-repeat center center;
            background-size: cover;
            display: none;
        }
        .hidden { display: none; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <h1>Shiritori Game</h1>
    <button onclick="startNormalMode()">Normal Mode</button>
    <button onclick="startRankedMode()">Ranked Mode</button>
    
    <div id="normalMode">
        <p>Enter a word that starts with the last letter of the previous word!</p>
        <p>Last word: <span id="lastWord">None</span></p>
        <p>Next letter: <span id="nextLetter">Any</span></p>
        <input type="text" id="wordInput" placeholder="Enter a word" onkeypress="handleKeyPress(event)">
        <button onclick="submitWord()">Submit</button>
        <button onclick="resetGame()">Reset</button>
        <p id="status"></p>
        <p>Score: <span id="score">0</span></p>
        <div id="words"></div>
    </div>
    
    <div id="rankedMode" class="hidden">
        <p>Enter a word that starts with the last letter of the previous word!</p>
        <p>Enter your name:</p>
        <input type="text" id="playerName" placeholder="Your name"> 
        <button onclick="confirmName()" id = confirmNameButton>Confirm</button>
        <p id="playerNameC" class="hidden"> Player name:</p>
        <p><button onclick="startRankedGame()" id = startRankGameButton class = "hidden">Start game</button></p>
          <div id ="rankedInfo" class = "hidden">
          <p id="timer">Time Left: 300s</p>
          <p id="mistakes">Mistakes: 0</p>
          <p>Last word: <span id="rankedLastWord">None</span></p>
          <p>Next letter: <span id="rankedNextLetter">Any</span></p>
          <input type="text" id="rankedWordInput" placeholder="Enter a word" onkeypress="handleRankedKeyPress(event)">
          <button onclick="submitRankedWord()">Submit</button>
          <p id="rankedStatus"></p>
          <p>Score: <span id="rankedScore">0</span></p>
          <div id="rankedWords"></div>
          </div>
    </div>
    
    <script>
        
        let rankedWords = [];
        let rankedScore = 0;
        let rankedHighScores = JSON.parse(localStorage.getItem('highScores')) || [];
        let words = [];
        let score = 0;
        let highScores = JSON.parse(localStorage.getItem('highScores')) || [];
        let mistakes = 0;
        let gameOver = 0;
        let playerName = "";

        async function isValidWord(word) {
            let response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
            return response.ok;
        }
        
        function startNormalMode() {
            document.getElementById('normalMode').classList.remove('hidden');
            document.getElementById('rankedMode').classList.add('hidden');
        }
        
        function startRankedMode() {
            document.getElementById('normalMode').classList.add('hidden');
            document.getElementById('rankedMode').classList.remove('hidden');
        }
        
        function confirmName() {
            let playerName = document.getElementById('playerName').value;
            if (!playerName) {
                alert("Please enter your name to start ranked mode!");
                return;
            }
            document.getElementById('playerName').classList.add('hidden');
            document.getElementById('playerNameC').classList.remove('hidden');
            document.getElementById('confirmNameButton').classList.add('hidden');
            document.getElementById('playerNameC').textContent = "Player Name: " + playerName;
            document.getElementById('startRankGameButton').classList.remove('hidden');
            
        }
        
        function startRankedGame() {

            rankedScore = 0;
            mistakes = 0;
            timeLeft = 30;
            document.getElementById('rankedScore').textContent = rankedScore;
            document.getElementById('rankedWords').innerHTML = "";
            document.getElementById('rankedStatus').textContent = "";
            document.getElementById('rankedInfo').classList.remove('hidden');
            document.getElementById('startRankGameButton').classList.add('hidden');
            startTimer();
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                if (timeLeft == 0) {
                    clearInterval(timerInterval);
                    if (gameOver == 1) {
                      isGameOver();
                    } 
                }

                document.getElementById('timer').textContent = "Time Left: " + timeLeft + "s";
                timeLeft--;
            }, 1000);
        }
        
        function resetRankedGame() {
            rankedWords = [];
            rankedScore = 0;
            timeLeft = 0;
            mistakes = 0;
            gameOver = 0;
            document.getElementById('rankedScore').textContent = score;
            document.getElementById('rankedWords').innerHTML = "";
            document.getElementById('rankedStatus').textContent = "";
            document.getElementById('rankedLastWord').textContent = "None";
            document.getElementById('rankedNextLetter').textContent = "Any";
            document.getElementById('timer').textContent = "Time Left: 0s";
            document.getElementById('mistakes').textContent = "Mistakes: 0";
            document.getElementById('rankedWordInput').value = "";
          
        }
        
        async function submitRankedWord() {
            let input = document.getElementById('rankedWordInput').value.trim().toLowerCase();
            let status = document.getElementById('rankedStatus');
            
            if (input === "") return;
            if (!(await isValidWord(input))) {
                status.textContent = "Invalid word! Please enter a real word.";
                mistakes++;
                document.getElementById('mistakes').textContent = "Mistakes: " + mistakes;
                if (mistakes >= 3) {
                  gameOver = 1;
                  isGameOver();
                }
                return;
            }
            if (rankedWords.length > 0) {
                let lastRankedWord = rankedWords[rankedWords.length - 1];
                if (input[0] !== lastRankedWord[lastRankedWord.length - 1]) {
                    rankedStatus.textContent = "Incorrect! The word must start with '" + lastRankedWord[lastRankedWord.length - 1] + "'.";
                    mistakes++;
                    document.getElementById('mistakes').textContent = "Mistakes: " + mistakes;
                    if (mistakes >= 3) {
                      gameOver = 1;
                      isGameOver();
                    }
                    return;
                }
                if (rankedWords.includes(input)) {
                    rankedStatus.textContent = "This word has already been used! Try another one.";
                    mistakes++;
                    document.getElementById('mistakes').textContent = "Mistakes: " + mistakes;
                    if (mistakes >= 3) {
                      gameOver = 1;
                      isGameOver()
                    }
                    return;

                }
            }


            // sendWordToSheet(input);
            rankedWords.push(input);
            rankedScore++;
            document.getElementById('rankedScore').textContent = rankedScore;
            document.getElementById('rankedWords').innerHTML = words.join(' → ');
            document.getElementById('rankedLastWord').textContent = input;
            document.getElementById('rankedNextLetter').textContent = input[input.length - 1];
            document.getElementById('rankedWordInput').value = "";
            document.getElementById('mistakes').textContent = "Mistakes: " + mistakes;
            rankedStatus.textContent = "";
            showDinoAnimation();
            // sendDataToSheet();
            // Send the word to Google Sheets
            
            // let input = document.getElementById('rankedWordInput').value.trim().toLowerCase();
            // if (!input) return;
            
            // if (mistakes >= 3) {
            //     endRankedGame();
            //     return;
            // }
            
            // rankedScore++;
            // document.getElementById('rankedScore').textContent = rankedScore;
            // document.getElementById('rankedWordInput').value = "";
        }
        
        function isGameOver() {
          if (gameOver == 1) {
            endRankedGame();
          }
        }
        
        function endRankedGame() {
            alert("Game Over! Your score: " + rankedScore);
            sendRankedScore();
            resetRankedGame();
        }
        
        function sendRankedScore() {
            const API_URL = "https://script.google.com/macros/s/AKfycbzuh6hfKMW1eXS0BGWxzUDMGbk37g2WxfEhSlXPJNUBscHkSBdQwJAvDHaI6vVOWzHwpg/exec";
            let playerName = document.getElementById('playerName').value;
            fetch(API_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name: playerName, score: rankedScore })
            });
        }


        async function submitWord() {
            let input = document.getElementById('wordInput').value.trim().toLowerCase();
            let status = document.getElementById('status');
            
            if (input === "") return;
            if (!(await isValidWord(input))) {
                status.textContent = "Invalid word! Please enter a real word.";
                return;
            }
            if (words.length > 0) {
                let lastWord = words[words.length - 1];
                if (input[0] !== lastWord[lastWord.length - 1]) {
                    status.textContent = "Incorrect! The word must start with '" + lastWord[lastWord.length - 1] + "'.";
                    return;
                }
                if (words.includes(input)) {
                    status.textContent = "This word has already been used! Try another one.";
                    return;
                }
            }
            sendWordToSheet(input);
            words.push(input);
            score++;
            document.getElementById('score').textContent = score;
            document.getElementById('words').innerHTML = words.join(' → ');
            document.getElementById('lastWord').textContent = input;
            document.getElementById('nextLetter').textContent = input[input.length - 1];
            document.getElementById('wordInput').value = "";
            status.textContent = "";
            showDinoAnimation();
            // sendDataToSheet();
            // Send the word to Google Sheets
            
        }
        

        async function sendWordToSheet(wo) {
            const API_URL = "https://script.google.com/macros/s/AKfycbzuh6hfKMW1eXS0BGWxzUDMGbk37g2WxfEhSlXPJNUBscHkSBdQwJAvDHaI6vVOWzHwpg/exec";
        
            try {
                let response = await fetch(API_URL, {
                    method: "POST",
                    mode: "no-cors", // Allows request but prevents getting response
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ word: wo })
                });
        
                console.log("Word sent to Google Sheets:", wo);
            } catch (error) {
                console.error("Error sending to Google Sheets:", error);
            }
        }
        
        function handleKeyPress(event) {
            if (event.key === "Enter") {
                submitWord();
            }
        }

        function resetGame() {
            // updateHighScores();
            words = [];
            score = 0;
            document.getElementById('score').textContent = score;
            document.getElementById('words').innerHTML = "";
            document.getElementById('status').textContent = "";
            document.getElementById('lastWord').textContent = "None";
            document.getElementById('nextLetter').textContent = "Any";
            document.getElementById('wordInput').value = "";
        }

        function updateHighScores() {
            highScores.push(score);
            highScores.sort((a, b) => b - a);
            highScores = highScores.slice(0, 5);
            localStorage.setItem('highScores', JSON.stringify(highScores));
            displayHighScores();
        }

        function displayHighScores() {
            let highScoresList = document.getElementById('highScores');
            highScoresList.innerHTML = highScores.map(score => `<li>${score}</li>`).join('');
        }
        displayHighScores();

        function showDinoAnimation() {
            let dino = document.getElementById('dinoFrame');
            dino.style.display = 'block';
            setTimeout(() => {
                dino.style.display = 'none';
            }, 1500);
        }
    </script>
</body>
</html>
